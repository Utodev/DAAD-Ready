const NESTED_DOALL_ENABLED=!1,DEBUG_ENABLED=!0,MALUVA_DISABLED=!1,RESOLUTION_X=320,RESOLUTION_Y=200,COLUMN_WIDTH=6,LINE_HEIGHT=8,NUM_WINDOWS=8,NUM_COLUMNS=50,NUM_LINES=25,NO_WORD=255,END_OF_PROCESS_MARK=0,END_OF_CONDACTS_MARK=255,END_OF_CONNECTIONS_MARK=255,NUM_LOCATIONS=256,MAX_LOCATION=255,LAST_CONVERTIBLE_NOUN=19,LAST_PROPER_NOUN=50,MAX_CONDACTS=128,ESCAPE_OBJNAME="_",ESCAPE_OBJNAME_CAPS="@",OFUSCATE_VALUE=255,WORD_LENGHT=5,COMPLETE_WORD_LENGHT=15,STANDARD_SEPARATORS=[".",",",";",":"],SPANISH_TERMINATIONS=["LO","LA","LOS","LAS"],MAX_CONJUNCTIONS=256,NUM_HISTORY_ORDERS=10,VOC_VERB=0,VOC_ADVERB=1,VOC_NOUN=2,VOC_ADJECT=3,VOC_PREPOSITION=4,VOC_CONJUGATION=5,VOC_PRONOUN=6,VOC_ANY=7,VOC_TYPE=[0,1,2,3,4,5,6,7];var paper,audioContext,FREQ_TABLE=[16.35,17.32,18.35,19.45,20.6,21.83,23.12,24.5,25.96,27.5,29.14,30.87,32.7,34.65,36.71,38.89,41.2,43.65,46.25,49,51.91,55,58.27,61.74,65.41,69.3,73.42,77.78,82.41,87.31,92.5,98,103.83,110,116.54,123.47,130.81,138.59,146.83,155.56,164.81,174.61,185,196,207.65,220,233.08,246.94,261.63,277.18,293.66,311.13,329.63,349.23,369.99,392,415.3,440,466.16,493.88,523.25,554.37,587.33,622.25,659.26,698.46,739.99,783.99,830.61,880,932.33,987.77,1046.5,1108.73,1174.66,1244.51,1318.51,1396.91,1479.98,1567.98,1661.22,1760,1864.66,1975.53,2093,2217.46,2349.32,2489.02,2637.02,2793.83,2959.96,3135.96,3322.44,3520,3729.31,3951.07,4186.01,4434.92,4698.64,4978.03];const SM0=0,SM1=1,SM2=2,SM3=3,SM4=4,SM5=5,SM6=6,SM7=7,SM8=8,SM9=9,SM10=10,SM11=11,SM12=12,SM13=13,SM14=14,SM15=15,SM16=16,SM17=17,SM18=18,SM19=19,SM20=20,SM21=21,SM22=22,SM23=23,SM24=24,SM25=25,SM26=26,SM27=27,SM28=28,SM29=29,SM30=30,SM31=31,SM32=32,SM33=33,SM34=34,SM35=35,SM36=36,SM37=37,SM38=38,SM39=39,SM40=40,SM41=41,SM42=42,SM43=43,SM44=44,SM45=45,SM46=46,SM47=47,SM48=48,SM49=49,SM50=50,SM51=51,SM52=52,SM53=53,SM54=54,SM55=55,SM56=56,SM57=57,SM58=58,SM59=59,SM60=60,SM61=61,SM62=62,SM63=63,SM64=64,SM65=65,SM66=66,SM67=67,SM68=68,SM69=69,SM70=70,FDARK=0,FCARRIED=1,FMOUSE=29,FSCORE=30,FTURNS_LO=31,FTURNS_HI=32,FVERB=33,FNOUN=34,FADJECT=35,FADVERB=36,FOBJECTS_CONVEYABLE=37,FPLAYER=38,FINPUT=41,FPROMPT=42,FPREP=43,FNOUN2=44,FADJECT2=45,FPRONOUN=46,FPRONOUN_ADJECT=47,FTIMEOUT=48,FTIMEOUT_CONTROL=49,FDOALL=50,FREFOBJ=51,FPLAYER_STRENGTH=52,FOBJECT_PRINT_FLAGS=53,FREFOBJLOC=54,FREFOBJWEIGHT=55,FREFOBJCONTAINER=56,FREFOBJWEARABLE=57,FREFOBJATTR1=58,FREFOBJATTR2=59,FKEY1=60,FKEY2=61,FSCREENMODE=62,FactiveWindow=63,NUM_FLAGS=256,MAX_FLAG_VALUE=255,NUM_OBJECTS=256,MAX_OBJECT=255,NO_OBJECT=255,LOC_NOT_CREATED=252,LOC_CARRIED=254,LOC_WORN=253,colours=["#000000","#0000AA","#00AA00","#0000AAAA","#AA0000","#AA00AA","#AA5500","#AAAAAA","#555555","#5555FF","#55FF55","#55FFFF","#FF5555","#FF55FF","#FFFF55","#FFFFFF"],condactTable=[{condactName:"AT     ",condactRoutine:_AT,numParams:1},{condactName:"NOTAT  ",condactRoutine:_NOTAT,numParams:1},{condactName:"ATGT   ",condactRoutine:_ATGT,numParams:1},{condactName:"ATLT   ",condactRoutine:_ATLT,numParams:1},{condactName:"PRESENT",condactRoutine:_PRESENT,numParams:1},{condactName:"ABSENT ",condactRoutine:_ABSENT,numParams:1},{condactName:"WORN   ",condactRoutine:_WORN,numParams:1},{condactName:"NOTWORN",condactRoutine:_NOTWORN,numParams:1},{condactName:"CARRIED",condactRoutine:_CARRIED,numParams:1},{condactName:"NOTCARR",condactRoutine:_NOTCARR,numParams:1},{condactName:"CHANCE ",condactRoutine:_CHANCE,numParams:1},{condactName:"ZERO   ",condactRoutine:_ZERO,numParams:1},{condactName:"NOTZERO",condactRoutine:_NOTZERO,numParams:1},{condactName:"EQ     ",condactRoutine:_EQ,numParams:2},{condactName:"GT     ",condactRoutine:_GT,numParams:2},{condactName:"LT     ",condactRoutine:_LT,numParams:2},{condactName:"ADJECT1",condactRoutine:_ADJECT1,numParams:1},{condactName:"ADVERB ",condactRoutine:_ADVERB,numParams:1},{condactName:"SFX    ",condactRoutine:_SFX,numParams:2},{condactName:"DESC   ",condactRoutine:_DESC,numParams:1},{condactName:"QUIT   ",condactRoutine:_QUIT,numParams:0},{condactName:"END    ",condactRoutine:_END,numParams:0},{condactName:"DONE   ",condactRoutine:_DONE,numParams:0},{condactName:"OK     ",condactRoutine:_OK,numParams:0},{condactName:"ANYKEY ",condactRoutine:_ANYKEY,numParams:0},{condactName:"SAVE   ",condactRoutine:_SAVE,numParams:1},{condactName:"LOAD   ",condactRoutine:_LOAD,numParams:1},{condactName:"DPRINT ",condactRoutine:_DPRINT,numParams:1},{condactName:"DISPLAY",condactRoutine:_DISPLAY,numParams:1},{condactName:"CLS    ",condactRoutine:_CLS,numParams:0},{condactName:"DROPALL",condactRoutine:_DROPALL,numParams:0},{condactName:"AUTOG  ",condactRoutine:_AUTOG,numParams:0},{condactName:"AUTOD  ",condactRoutine:_AUTOD,numParams:0},{condactName:"AUTOW  ",condactRoutine:_AUTOW,numParams:0},{condactName:"AUTOR  ",condactRoutine:_AUTOR,numParams:0},{condactName:"PAUSE  ",condactRoutine:_PAUSE,numParams:1},{condactName:"SYNONYM",condactRoutine:_SYNONYM,numParams:2},{condactName:"GOTO   ",condactRoutine:_GOTO,numParams:1},{condactName:"MESSAGE",condactRoutine:_MESSAGE,numParams:1},{condactName:"REMOVE ",condactRoutine:_REMOVE,numParams:1},{condactName:"GET    ",condactRoutine:_GET,numParams:1},{condactName:"DROP   ",condactRoutine:_DROP,numParams:1},{condactName:"WEAR   ",condactRoutine:_WEAR,numParams:1},{condactName:"DESTROY",condactRoutine:_DESTROY,numParams:1},{condactName:"CREATE ",condactRoutine:_CREATE,numParams:1},{condactName:"SWAP   ",condactRoutine:_SWAP,numParams:2},{condactName:"PLACE  ",condactRoutine:_PLACE,numParams:2},{condactName:"SET    ",condactRoutine:_SET,numParams:1},{condactName:"CLEAR  ",condactRoutine:_CLEAR,numParams:1},{condactName:"PLUS   ",condactRoutine:_PLUS,numParams:2},{condactName:"MINUS  ",condactRoutine:_MINUS,numParams:2},{condactName:"LET    ",condactRoutine:_LET,numParams:2},{condactName:"NEWLINE",condactRoutine:_NEWLINE,numParams:0},{condactName:"PRINT  ",condactRoutine:_PRINT,numParams:1},{condactName:"SYSMESS",condactRoutine:_SYSMESS,numParams:1},{condactName:"ISAT   ",condactRoutine:_ISAT,numParams:2},{condactName:"SETCO  ",condactRoutine:_SETCO,numParams:1},{condactName:"SPACE  ",condactRoutine:_SPACE,numParams:0},{condactName:"HASAT  ",condactRoutine:_HASAT,numParams:1},{condactName:"HASNAT ",condactRoutine:_HASNAT,numParams:1},{condactName:"LISTOBJ",condactRoutine:_LISTOBJ,numParams:0},{condactName:"EXTERN ",condactRoutine:_EXTERN,numParams:2},{condactName:"RAMSAVE",condactRoutine:_RAMSAVE,numParams:0},{condactName:"RAMLOAD",condactRoutine:_RAMLOAD,numParams:1},{condactName:"BEEP   ",condactRoutine:_BEEP,numParams:2},{condactName:"PAPER  ",condactRoutine:_PAPER,numParams:1},{condactName:"INK    ",condactRoutine:_INK,numParams:1},{condactName:"BORDER ",condactRoutine:_BORDER,numParams:1},{condactName:"PREP   ",condactRoutine:_PREP,numParams:1},{condactName:"NOUN2  ",condactRoutine:_NOUN2,numParams:1},{condactName:"ADJECT2",condactRoutine:_ADJECT2,numParams:1},{condactName:"ADD    ",condactRoutine:_ADD,numParams:2},{condactName:"SUB    ",condactRoutine:_SUB,numParams:2},{condactName:"PARSE  ",condactRoutine:_PARSE,numParams:1},{condactName:"LISTAT ",condactRoutine:_LISTAT,numParams:1},{condactName:"PROCESS",condactRoutine:_PROCESS,numParams:1},{condactName:"SAME   ",condactRoutine:_SAME,numParams:2},{condactName:"MES    ",condactRoutine:_MES,numParams:1},{condactName:"WINDOW ",condactRoutine:_WINDOW,numParams:1},{condactName:"NOTEQ  ",condactRoutine:_NOTEQ,numParams:2},{condactName:"NOTSAME",condactRoutine:_NOTSAME,numParams:2},{condactName:"MODE   ",condactRoutine:_MODE,numParams:1},{condactName:"WINAT  ",condactRoutine:_WINAT,numParams:2},{condactName:"TIME   ",condactRoutine:_TIME,numParams:2},{condactName:"PICTURE",condactRoutine:_PICTURE,numParams:1},{condactName:"DOALL  ",condactRoutine:_DOALL,numParams:1},{condactName:"MOUSE  ",condactRoutine:_MOUSE,numParams:1},{condactName:"GFX    ",condactRoutine:_GFX,numParams:2},{condactName:"ISNOTAT",condactRoutine:_ISNOTAT,numParams:2},{condactName:"WEIGH  ",condactRoutine:_WEIGH,numParams:2},{condactName:"PUTIN  ",condactRoutine:_PUTIN,numParams:2},{condactName:"TAKEOUT",condactRoutine:_TAKEOUT,numParams:2},{condactName:"NEWTEXT",condactRoutine:_NEWTEXT,numParams:0},{condactName:"ABILITY",condactRoutine:_ABILITY,numParams:2},{condactName:"WEIGHT ",condactRoutine:_WEIGHT,numParams:1},{condactName:"RANDOM ",condactRoutine:_RANDOM,numParams:1},{condactName:"INPUT  ",condactRoutine:_INPUT,numParams:21},{condactName:"SAVEAT ",condactRoutine:_SAVEAT,numParams:0},{condactName:"BACKAT ",condactRoutine:_BACKAT,numParams:0},{condactName:"PRINTAT",condactRoutine:_PRINTAT,numParams:2},{condactName:"WHATO  ",condactRoutine:_WHATO,numParams:0},{condactName:"CALL   ",condactRoutine:_CALL,numParams:1},{condactName:"PUTO   ",condactRoutine:_PUTO,numParams:1},{condactName:"NOTDONE",condactRoutine:_NOTDONE,numParams:0},{condactName:"AUTOP  ",condactRoutine:_AUTOP,numParams:1},{condactName:"AUTOT  ",condactRoutine:_AUTOT,numParams:1},{condactName:"MOVE   ",condactRoutine:_MOVE,numParams:1},{condactName:"WINSIZE",condactRoutine:_WINSIZE,numParams:2},{condactName:"REDO   ",condactRoutine:_REDO,numParams:0},{condactName:"CENTRE ",condactRoutine:_CENTRE,numParams:0},{condactName:"EXIT   ",condactRoutine:_EXIT,numParams:1},{condactName:"INKEY  ",condactRoutine:_INKEY,numParams:0},{condactName:"BIGGER ",condactRoutine:_BIGGER,numParams:2},{condactName:"SMALLER",condactRoutine:_SMALLER,numParams:2},{condactName:"ISDONE ",condactRoutine:_ISDONE,numParams:0},{condactName:"ISNDONE",condactRoutine:_ISNDONE,numParams:0},{condactName:"SKIP   ",condactRoutine:_SKIP,numParams:1},{condactName:"RESTART",condactRoutine:_RESTART,numParams:0},{condactName:"TAB    ",condactRoutine:_TAB,numParams:1},{condactName:"COPYOF ",condactRoutine:_COPYOF,numParams:2},{condactName:"dumb   ",condactRoutine:_dumb,numParams:0},{condactName:"COPYOO ",condactRoutine:_COPYOO,numParams:2},{condactName:"dumb   ",condactRoutine:_dumb,numParams:0},{condactName:"COPYFO ",condactRoutine:_COPYFO,numParams:2},{condactName:"dumb   ",condactRoutine:_dumb,numParams:0},{condactName:"COPYFF ",condactRoutine:_COPYFF,numParams:2},{condactName:"COPYBF ",condactRoutine:_COPYBF,numParams:2},{condactName:"RESET  ",condactRoutine:_RESET,numParams:0}];class wordClass{aCode=255;aType=7}class parserClass{constructor(){}}class windowClass{line=0;col=0;height=25;width=50;operationMode=0;currentY=0;currentX=0;backupCurrentY=0;backupCurrentX=0;INK=15;PAPER=0;BORDER=0;lastPauseLine=0}class WindowArrayClass{windows=[];activeWindow=0;lastPrintedIsCR=0;charsetShift=0;backupStream=0;constructor(){windows=[];for(var e=0;e<8;e++){var t=new windowClass;this.windows.push(t)}this.resetWindows()}resetWindows(){for(var e=0;e<8;e++)this.windows[e].line=0,this.windows[e].col=0,this.windows[e].height=25,this.windows[e].width=50,this.windows[e].operationMode=0,this.windows[e].currentX=0,this.windows[e].currentY=0,this.windows[e].backupCurrentX=0,this.windows[e].backupCurrentY=0,this.windows[e].PAPER=0,this.windows[e].BORDER=0,this.windows[e].INK=15;this.lastPrintedIsCR=0,this.charsetShift=0,this.backupStream=0,this.activeWindow=0}}class DDBHeader{version=0;targetMachineLanguage=0;the95=0;numObj=0;numLoc=0;numMsg=0;numSys=0;numPro=0;tokenPos=0;processPos=0;objectPos=0;locationPos=0;messagePos=0;sysmessPos=0;connectionPos=0;vocabularyPos=0;objInitiallyAtPos=0;objNamePos=0;objWeightContWearPos=0;objAttributesPos=0;fileLength=0}class DDBClass{header=0;processPTR=0;entryPTR=0;condactPTR=0;doallPTR=0;doallentryPTR=0;doallLocation=0;constructor(){this.header=new DDBHeader,this.header.version=this.getByte(0),this.header.targetMachineLanguage=this.getByte(1),this.header.the95=this.getByte(2),this.header.numObj=this.getByte(3),this.header.numLoc=this.getByte(4),this.header.numMsg=this.getByte(5),this.header.numSys=this.getByte(6),this.header.numPro=this.getByte(7),this.header.tokenPos=this.getWord(8),this.header.processPos=this.getWord(10),this.header.objectPos=this.getWord(12),this.header.locationPos=this.getWord(14),this.header.messagePos=this.getWord(16),this.header.sysmessPos=this.getWord(18),this.header.connectionPos=this.getWord(20),this.header.vocabularyPos=this.getWord(22),this.header.objInitiallyAtPos=this.getWord(24),this.header.objNamePos=this.getWord(26),this.header.objWeightContWearPos=this.getWord(28),this.header.objAttributesPos=this.getWord(30),this.header.fileLength=this.getWord(32),this.processPTR=0,this.entryPTR=0,this.condactPTR=0,this.doallPTR=0,this.doallentryPTR=0,this.doallLocation=0}getByte(e){return e>65534?0:DDBDATA[e]}getWord(e){return this.getByte(e)+256*this.getByte(e+1)}resetProcesses(){this.doallPTR=0,this.doallentryPTR=0,this.condactPTR=0,this.processPTR=this.header.processPos,this.entryPTR=this.getWord(this.processPTR)}consumeProcess(){for(;0!=this.getByte(this.entryPTR);)this.entryPTR+=4;this.entryPTR-=4}isSpanish(){return(1&this.header.targetMachineLanguage)!=0}}class flagClass{#a=[];#b=[];constructor(){for(var e=0;e<256;e++)this.#a.push(0),this.#b.push(0)}resetFlags(){for(var e=0;e<256;e++)this.#a[e]=0,this.#b[e]=0}getFlag(e){return this.#a[e]}setFlag(e,t){this.#a[e]=t}getFlagBit(e,t){return(this.getFlag(e)&1<<t)!=0}RAMSAVEFlags(){for(var e=0;e<256;e++)this.#b[e]=this.#a[e]}RAMLOADFlags(e){for(var t=0;t<e;t++)this.#a[t]=this.#b[t]}}class objectClass{#c=[];#d=[];constructor(){for(var e=0;e<256;e++)this.#c.push(0),this.#d.push(0)}getObjectLocation(e){return this.#c[e]}setObjectLocation(e,t){this.#c[e]=t}getObjectCountAt(e){for(var t=0,a=0;a<DDB.header.numObj;a++)this.getObjectLocation(a)==e&&t++;return t}RAMSAVEObjects(){for(var e=0;e<256;e++)this.#d[e]=this.#c[e]}RAMLOADObjects(){for(var e=0;e<256;e++)this.#c[e]=this.#d[e]}getObjectWeight(e){return 63&DDB.getByte(DDB.header.objWeightContWearPos+e)}getObjectFullWeight(e){if(e>=DDB.header.numObj)t=0;else{var t=this.getObjectWeight(e);if(this.isObjectContainer(e)&&0!=t){for(var a=0;a<DDB.header.numObj;a++)if(this.getObjectLocation(a)==e){var n=this.getObjectFullWeight(a);if(!(t+n<=255))return 255;t+=n}}}return t}getWeightOfObjectsAt(e){for(var t=0,a=0;a<DDB.header.numObj;a++)if(this.getObjectLocation(a)==e){var n=this.getObjectFullWeight(a);if(t+n>255)return 255;t+=n}return t}resetObjects(){for(var e=0;e<256;e++)this.setObjectLocation(e,252);flags.setFlag(1,0);for(var e=0;e<DDB.header.numObj;e++)this.setObjectLocation(e,DDB.getByte(DDB.header.objInitiallyAtPos+e)),this.getObjectLocation(e)==LOC_CARRIED&&flags.setFlag(1,flags.getFlag(1)+1)}setReferencedObject(e){flags.setFlag(51,e),255!=e&&(flags.setFlag(54,this.getObjectLocation(e)),flags.setFlag(55,63&DDB.getByte(DDB.header.objWeightContWearPos+e)),this.isObjectContainer(e)?flags.setFlag(56,128):flags.setFlag(56,0),this.isObjectWearable(e)?flags.setFlag(57,128):flags.setFlag(57,0),flags.setFlag(59,DDB.getByte(DDB.header.objAttributesPos+2*e)),flags.setFlag(58,DDB.getByte(DDB.header.objAttributesPos+2*e+1)),flags.setFlag(34,DDB.getByte(DDB.header.objNamePos+2*e)),flags.setFlag(35,DDB.getByte(DDB.header.objNamePos+2*e+1)))}isObjectWearable(e){return 128&DDB.getByte(DDB.header.objWeightContWearPos+e)}isObjectContainer(e){return 64&DDB.getByte(DDB.header.objWeightContWearPos+e)}getObjectByVocabularyAtLocation(e,t,a){for(var n=!1,o=255,s=0;s<DDB.header.numObj;s++)if(255==a||this.getObjectLocation(s)==a){var r=DDB.getByte(DDB.header.objNamePos+2*s),c=DDB.getByte(DDB.header.objNamePos+2*s+1);if(255!=r&&r==e&&(255==c||c==t))return s;n||r!=e||255!=t||(n=!0,o=s)}return o}getNextObjectAt(e,t){if(255==e)return 255;255==t&&(t=flags.getFlag(38));do e++;while(!(255==e||this.getObjectLocation(e)==t));return e}}class stackElementClass{processPTR=0;entryPTR=0;condactPTR=0;doallPTR=0;doallentryPTR=0;DoallFlag=0;doallLocation=0}class stackClass{processStack=[];stackPTR=0;constructor(){this.resetStack()}resetStack(){this.processStack=[],this.stackPTR=0}stackPop(){if(!this.stackPTR){isTerminated=!0;return}this.stackPTR--;var e=this.processStack[this.stackPTR];DDB.processPTR=e.processPTR,DDB.entryPTR=e.entryPTR,DDB.condactPTR=e.condactPTR,DDB.doallPTR=e.doallPTR,DDB.doallentryPTR=e.doallentryPTR,DDB.doallLocation=e.doallLocation,flags.setFlag(50,e.DoallFlag)}stackPush(){var e=new stackElementClass;e.processPTR=DDB.processPTR,e.entryPTR=DDB.entryPTR,e.condactPTR=DDB.condactPTR,e.doallPTR=DDB.doallPTR,e.doallentryPTR=DDB.doallentryPTR,e.DoallFlag=flags.getFlag(50),e.doallLocation=DDB.doallLocation,this.processStack[this.stackPTR]=e,this.stackPTR++}}var inputBuffer="",flags=new flagClass,objects=new objectClass,DDB=new DDBClass,stack=new stackClass,windows=new WindowArrayClass,previousVerb=255,playerOrderQuoted="",playerOrder="",conjunctions=[],globalParseOption=0,keyBoardStatus=[],keyBoardStatusShiftKeys=0,ticks=0,TimeoutHappened=!1,TimeoutSeconds=0,TimeoutPreservedOrder="",SaveX=0,SaveY=0,readTextStr="",inputTakenFromPlayer=!1,YesResponse="",PreserveTimeout=0,condactResult=!1,done=!1,Parameter1=0,Parameter2=0,inPARSE=!1,inANYKEY=!1,inEND=!1,inQUIT=!1,inSAVE=!1,inLOAD=!1,isTerminated=!1;function run(e){done=!1;RunEntry:for(;;){if(!e&&0==DDB.getByte(DDB.entryPTR)){var t=!1;if(0!=DDB.doallPTR){debug("In Doall");var a=objects.getNextObjectAt(flags.getFlag(50),DDB.doallLocation);255!=a?(DDB.entryPTR=DDB.doallEntryPTR,DDB.condactPTR=DDB.doallPTR,objects.setReferencedObject(a),debug("Next DOALL Object:"+a),flags.setFlag(50,a),e=!0,t=!0):(debug("No more DOALL Objets"),DDB.doallPTR=0)}if(!t){if(debug("Process finishes normally"),stack.stackPop(),isTerminated){$(".goodbye").show();return}DDB.condactPTR++,e=!0}}if(!e){if(ValidEntry=(DDB.getByte(DDB.entryPTR)==flags.getFlag(33)||255==DDB.getByte(DDB.entryPTR))&&(DDB.getByte(DDB.entryPTR+1)==flags.getFlag(34)||255==DDB.getByte(DDB.entryPTR+1)),DDB.condactPTR=DDB.getWord(DDB.entryPTR+2),!ValidEntry){DDB.entryPTR+=4;continue RunEntry}debug("> "+getWordByCodeType(DDB.getByte(DDB.entryPTR),0)+" "+getWordByCodeType(DDB.getByte(DDB.entryPTR+1),2))}for(;;){e=!1,condactResult=!0;var n=DDB.getByte(DDB.condactPTR);if(255==n){debug("    EOC"),DDB.entryPTR+=4;continue RunEntry}flags.setFlag(62,142),flags.setFlag(29,128);var o=(128&n)!=0;o&&(n&=127);var s=condactTable[n].condactName+" ";if(condactTable[n].numParams>0&&(DDB.condactPTR++,Parameter1=DDB.getByte(DDB.condactPTR),o&&(o&&(s+="@"),Parameter1=flags.getFlag(Parameter1)),s+=Parameter1,condactTable[n].numParams>1&&(DDB.condactPTR++,s=s+" "+(Parameter2=DDB.getByte(DDB.condactPTR)))),debug("    "+s),condactResult=!0,condactTable[n].condactRoutine(),inPARSE||inANYKEY||inQUIT||inEND||inSAVE||inLOAD)return;if(!condactResult){DDB.entryPTR+=4;continue RunEntry}DDB.condactPTR++}}}function initializeParser(){for(inputBuffer="",ptr=DDB.header.vocabularyPos;0!=DDB.getByte(ptr);){if(5==VOC_TYPE.indexOf(DDB.getByte(ptr+6))){aVocWord="";for(var e=0;e<5;e++)(255^DDB.getByte(ptr+e))!=32&&(aVocWord+=String.fromCharCode(255^DDB.getByte(ptr+e)));256==conjunctions.length&&Error(5,"Too many conjunctions. Maximum accepted is 256"),conjunctions.push(" "+aVocWord.toUpperCase()+" ")}ptr+=7}}function fixSpanishCharacters(e){for(var t="\xba\xa1\xbf\xab\xbb\xe1\xe9\xed\xf3\xfa\xf1\xd1\xe7\xc7\xfc\xdc",a="",n=0;n<e.length;n++){switch(e.charAt(n)){case"\xf1":a+="\xd1";break;case"\xe7":a+="\xc7";break;case"\xe1":case"\xc1":a+="A";break;case"\xe9":case"\xc9":a+="E";break;case"\xed":case"\xcd":a+="I";break;case"\xf3":case"\xd3":a+="O";break;case"\xfa":case"\xda":case"\xdc":case"\xfc":a+="U"}-1!=t.indexOf(e.charAt(n))?a+=String.fromCharCode(16+t.indexOf(e.charAt(n))):a+=e.charAt(n)}return a}function getCommand(e){inputBuffer="",e&&Sysmess(33);for(var t=0;t<8;t++)windows.windows[t].lastPauseLine=0;inputBuffer=readText()}function getCommandB(){DDB.isSpanish()&&(inputBuffer=fixSpanishCharacters(inputBuffer)),getPlayerOrdersB()}function findWord(e,t){var a={};for(ptr=DDB.header.vocabularyPos,a.aCode=-1,e=e.toUpperCase();0!=DDB.getByte(ptr);){aVocWord="";for(var n=0;n<5;n++)(255^DDB.getByte(ptr+n))!=32&&(aVocWord+=String.fromCharCode(255^DDB.getByte(ptr+n)));if(e==aVocWord&&(7==t||t==VOC_TYPE.indexOf(DDB.getByte(ptr+6)))){a.aCode=DDB.getByte(ptr+5),a.aType=VOC_TYPE.indexOf(DDB.getByte(ptr+6));break}ptr+=7}return a}function getWordByCodeType(e,t){if(255==e)return"_";for(ptr=DDB.header.vocabularyPos;0!=DDB.getByte(ptr);){aVocWord="";for(var a=0;a<5;a++)(255^DDB.getByte(ptr+a))!=32&&(aVocWord+=String.fromCharCode(255^DDB.getByte(ptr+a)));if(t==VOC_TYPE.indexOf(DDB.getByte(ptr+6))&&e==DDB.getByte(ptr+5))return aVocWord;ptr+=7}return"["+e+"]"}function getPlayerOrders(){getCommand(!0,!1)}function getPlayerOrdersB(){for(i=0,inputBuffer=inputBuffer.toUpperCase();i<conjunctions.length;i++)inputBuffer=inputBuffer.replace(conjunctions[i],".");inPARSE?(RestoreStream(),inputTakenFromPlayer=!0,parseB(),condactResult=!parseEnd(),done=!1,inPARSE=!1,condactResult?(DDB.condactPTR++,run(!0)):(DDB.entryPTR+=4,run(!1))):inQUIT?(inQUIT=!1,_QUITB()):inEND?(inEND=!1,_ENDB()):inSAVE?(inSAVE=!1,_SAVEB()):inLOAD&&(inLOAD=!1,_LOADB())}function parse(e){if(0==(globalParseOption=e)){if(inputTakenFromPlayer=!1,""==inputBuffer){PreserveStream(),0==flags.getFlag(42)?Sysmess(2+Math.floor(4*Math.random(4))):flags.getFlag(42)<DDB.header.numSys&&Sysmess(flags.getFlag(42)),inPARSE=!0,getPlayerOrders();return}parseB()}else playerOrder=playerOrderQuoted;return parseEnd(playerOrder)}function parseB(){for(playerOrder="",i=0;!STANDARD_SEPARATORS.includes(inputBuffer.charAt(i))&&i<inputBuffer.length;)playerOrder+=inputBuffer.charAt(i),i++;inputBuffer=i>inputBuffer.length?"":inputBuffer.substring(i+1),-1!=playerOrder.indexOf('"')?(-1!=(playerOrderQuoted=playerOrder.substring(playerOrder.indexOf('"')+1)).indexOf('"')&&(playerOrderQuoted=playerOrderQuoted.substring(0,playerOrderQuoted.indexOf('"')-1)),playerOrder=playerOrder.substring(playerOrder.indexOf('"')-1),""==(playerOrderQuoted=playerOrderQuoted.trim())&&(playerOrderQuoted=" ")):playerOrderQuoted=""}function parseEnd(){if(result=!1,""==playerOrder)return!1;for(playerOrder=playerOrder.trim();-1!=playerOrder.indexOf("  ");)playerOrder.replace("  "," ");var e=playerOrder.split(" ");flags.setFlag(33,255),flags.setFlag(34,255),flags.setFlag(35,255),flags.setFlag(44,255),flags.setFlag(45,255),flags.setFlag(36,255),flags.setFlag(43,255);for(var t=!1,a=0,n=e.length;a<n&&""!=e[a];){if(-1!=(aWordRecord=findWord(aSearchWord=e[a],7)).aCode&&(0==aWordRecord.aType&&255==flags.getFlag(33)?flags.setFlag(33,aWordRecord.aCode):2==aWordRecord.aType&&255==flags.getFlag(34)?flags.setFlag(34,aWordRecord.aCode):2==aWordRecord.aType&&255==flags.getFlag(44)?flags.setFlag(44,aWordRecord.aCode):3==aWordRecord.aType&&255==flags.getFlag(35)?flags.setFlag(35,aWordRecord.aCode):3==aWordRecord.aType&&255==flags.getFlag(45)?flags.setFlag(45,aWordRecord.aCode):4==aWordRecord.aType&&255==flags.getFlag(43)?flags.setFlag(43,aWordRecord.aCode):1==aWordRecord.aType&&255==flags.getFlag(36)?flags.setFlag(36,aWordRecord.aCode):DDB.isSpanish()||6!=aWordRecord.aType||t||(t=!0,255==flags.getFlag(34)&&(flags.setFlag(34,flags.getFlag(46)),flags.setFlag(35,flags.getFlag(47)))),DDB.isSpanish()&&0==aWordRecord.aType&&!t))for(j=0;j<4&&!t;)otherWords[a].toUpperCase().indexOf(SPANISH_TERMINATIONS[j])==1+e[a].length-SPANISH_TERMINATIONS[j].length&&-1!=(aWordRecord=FindWord(aSearchWord=e[a].substring(0,e[a].length-SPANISH_TERMINATIONS[j].length-1),0)).aCode&&(t=!0,255==flags.getFlag(34)&&(flags.setFlag(34,flags.getFlag(46)),flags.setFlag(35,flags.getFlag(47)))),j++;a++}return 0==globalParseOption&&255==flags.getFlag(33)&&19>=flags.getFlag(34)&&(flags.setFlag(33,flags.getFlag(34)),flags.setFlag(34,255)),inputTakenFromPlayer||255!=flags.getFlag(33)||255==flags.getFlag(34)||255==previousVerb||flags.setFlag(33,PreviousVerb),255==flags.getFlag(34)&&t&&255!=flags.getFlag(46)&&(flags.setFlag(34,flags.getFlag(46)),flags.setFlag(35,flags.getFlag(47))),flags.getFlag(34)>=50&&255!=flags.getFlag(34)&&(flags.setFlag(46,flags.getFlag(34)),flags.setFlag(47,flags.getFlag(35))),255!=flags.getFlag(33)&&(pPreviousVerb=flags.getFlag(33)),(255!=flags.getFlag(33)||255!=flags.getFlag(34))&&(result=!0),result||globalParseOption>0}function setCharAt(e,t,a){return t>e.length-1?e:e.substring(0,t)+a+e.substring(t+1)}function replaceArticles(e,t,a,n){if(t||n)for(;" "==e.charAt(0);)e=e.substring(1);if(n&&-1!=e.indexOf(".")&&(e=e.substring(0,e.indexOf("."))),t){if(DDB.isSpanish()){if("U"==e.charAt(0).toUpperCase()&&"N"==e.charAt(1).toUpperCase()&&" "==e.charAt(2))return(newArticle=a?"El":"el")+e.substring(2);if("U"==e.charAt(0).toUpperCase()&&"N"==e.charAt(1).toUpperCase())return(newArticle="L")+e.substring(2)}else{if("A"==e.charAt(0).toUpperCase()&&" "==e.charAt(1))return e.substring(2);if("S"==e.charAt(0).toUpperCase()&&"O"==e.charAt(1).toUpperCase()&&"M"==e.charAt(2).toUpperCase()&&"E"==e.charAt(3).toUpperCase()&&" "==e.charAt(4))return e.substring(5)}}return e}function getToken(e){for(index=0,ptr=DDB.header.tokenPos+1;index<e;)DDB.getByte(ptr)>127&&index++,ptr++;for(auxStr="";127>=DDB.getByte(ptr);)auxStr+=String.fromCharCode(DDB.getByte(ptr)),ptr++;return(auxStr+=String.fromCharCode(127&DDB.getByte(ptr))).replace("_"," ")}function getMessageInternal(e,t){var a="",n=DDB.getWord(e+2*t);DDB.previousWasCR=!1;for(var o=DDB.getByte(n);245!=o;)o<128?a+=token=getToken(tokenID=(255^o)-128):"_"==(mychar=String.fromCharCode(255^o))||"@"==mychar?(escapeText=getMessageInternal(DDB.header.objectPos,flags.getFlag(51)),a+=escapeText=replaceArticles(escapeText,!0,"@"==o,!0)):a+=mychar,n++,o=DDB.getByte(n);return a}function getMessage(e,t){return getMessageInternal(e,t)}function getMessageOTX(e,t,a,n){var o=getMessageInternal(DDB.header.objectPos,e);return replaceArticles(o,t,a,n)}function debug(e){console.log(e)}function setShiftKeys(e){keyBoardStatusShiftKeys=0,e.shiftKey&&(keyBoardStatusShiftKeys+=1),e.altKey&&(keyBoardStatusShiftKeys+=2),e.ctrlKey&&(keyBoardStatusShiftKeys+=4),e.metaKey&&(keyBoardStatusShiftKeys+=8)}function keyupHandler(e){keyBoardStatus.includes(e.keyCode)&&keyBoardStatus.splice(keyBoardStatus.indexOf(e.keyCode)),setShiftKeys(e)}function checkSpecialKeyCodes(e,t){if(116==e||123==e||t&&82==e)return!0}function keydownHandler(e){if(keyBoardStatus.includes(e.keyCode)||keyBoardStatus.push(e.keyCode),setShiftKeys(e),inQUIT||inEND||inSAVE||inLOAD||inPARSE){if(checkSpecialKeyCodes(e.keyCode,e.ctrlKey))return!0;e.preventDefault(),readTextB(e.keyCode)}if(inANYKEY){if(inANYKEY=!1,checkSpecialKeyCodes(e.keyCode,e.ctrlKey))return!0;e.preventDefault(),DDB.condactPTR++,run(!0)}}function Extern(e,t){}function delay(e){for(var t=1e3*e,a=Date.now(),n=a;n-a<t;)n=Date.now()}function clearWindow(e,t,a,n,o){paper.fillStyle=colours[o],paper.fillRect(e,t,a,n)}function Printat(e,t){e<windows.windows[windows.activeWindow].height&&t<windows.windows[windows.activeWindow].width&&(windows.windows[windows.activeWindow].CurrentY=8*e,windows.windows[windows.activeWindow].CurrentX=6*t)}function Tab(e){e<windows.windows[windows.activeWindow].width?windows.windows[windows.activeWindow].CurrentX=(windows.windows[windows.activeWindow].col+e)*6:Tab(0)}function SaveAt(){windows.windows[windows.activeWindow].BackupCurrentY=windows.windows[windows.activeWindow].currentY,windows.windows[windows.activeWindow].BackupCurrentX=windows.windows[windows.activeWindow].CurrentX}function BackAt(){windows.windows[windows.activeWindow].currentY=windows.windows[windows.activeWindow].backupCurrentY,windows.windows[windows.activeWindow].currentX=windows.windows[windows.activeWindow].backupCurrentX}function doSave(e){for(var t=[],a=0;a<256;a++)t.push(flags.getFlag(a));for(var a=0;a<256;a++)t.push(objects.getObjectLocation(a));e=e.hexEncode(),localStorage.removeItem(e),localStorage.setItem(e,JSON.stringify(t))}function doLoad(e){e=e.hexEncode();var t=localStorage.getItem(e);if(null==t)return Sysmess(57),!1;t=JSON.parse(t);for(var a=0;a<256;a++)flags.setFlag(a,t[a]);for(var a=0;a<256;a++)objects.setObjectLocation(a,t[a+256]);return!0}function getVideoAddr(e,t){return e+320*t}function pixel(e,t,a){paper.fillStyle=colours[a],paper.fillRect(e,t,1,1)}function nextChar(){windows.windows[windows.activeWindow].currentX=windows.windows[windows.activeWindow].currentX+6,windows.windows[windows.activeWindow].currentX>=(windows.windows[windows.activeWindow].col+windows.windows[windows.activeWindow].width)*6&&(windows.windows[windows.activeWindow].currentX=6*windows.windows[windows.activeWindow].col,windows.windows[windows.activeWindow].currentY=windows.windows[windows.activeWindow].currentY+8,windows.windows[windows.activeWindow].currentY>=(windows.windows[windows.activeWindow].line+windows.windows[windows.activeWindow].height)*8&&ScrollCurrentWindow())}function writeChar(e){switch(e){case 14:charsetShift=128;break;case 15:charsetShift=0;break;case 11:clearCurrentWindow();break;default:if(windows.windows[windows.activeWindow].currentX+6>=(windows.windows[windows.activeWindow].col+windows.windows[windows.activeWindow].width)*6)nextChar(),writeChar(e);else for(var t=0;t<8;t++){var a=font[(e+windows.charsetShift)%256*8+t];a>>=2;for(var n=0;n<6;n++)(a&1<<6-n)!=0?pixel(windows.windows[windows.activeWindow].currentX+n,windows.windows[windows.activeWindow].currentY+t,windows.windows[windows.activeWindow].INK):pixel(windows.windows[windows.activeWindow].currentX+n,windows.windows[windows.activeWindow].currentY+t,windows.windows[windows.activeWindow].PAPER)}nextChar()}}function StrLenInPixels(e){return 6*e.length}function writeWord(e){var t=(windows.windows[windows.activeWindow].col+windows.windows[windows.activeWindow].width)*6;if(StrLenInPixels(e)+windows.windows[windows.activeWindow].currentX>=t&&carriageReturn(),!(windows.lastPrintedIsCR&&" "==e))for(var a=0;a<e.length;a++)writeChar(e.charCodeAt(a));windows.lastPrintedIsCR=!1}function writeText(e,t=!0){t&&debug("Output:"+e);for(var a="",n=0;n<e.length;n++)switch(e.charCodeAt(n)){case 13:writeWord(a),a="",carriageReturn();break;case 32:writeWord(a),a="",writeWord(" ");break;default:a+=e.charAt(n)}writeWord(a)}function PatchStr(e){finalStr="";for(var t=0;t<e.length;t++)switch(e.charAt(t)){case"┬\xaa":finalStr+="\x10";break;case"┬\xa1":finalStr+="\x11";break;case"┬\xbf":finalStr+="\x12";break;case"┬\xab":finalStr+="\x13";break;case"┬\xbb":finalStr+="\x14";break;case"┬\xe1":finalStr+="\x15";break;case"Γ\xc7\xdc":finalStr+="\x16";break;case"┬\xed":finalStr+="\x17";break;case"┬\xf3":finalStr+="\x18";break;case"┬\xfa":finalStr+="\x19";break;case"┬\xf1":finalStr+="\x1a";break;case"┬\xd1":finalStr+="\x1b";break;case"Γ\xc7\xed":finalStr+="\x1c";break;case"Γ\xe9\xbc":finalStr+="\x1d";break;case"∩┐╜":finalStr+="\x1e";break;case"∩┐╜":finalStr+="\x1f";break;case"Γ\xc7\xaa":finalStr+=String.fromCharCode(14,16,15);break;case"\xc6":finalStr+=String.fromCharCode(14,17,15);break;case"Γ\xc7₧":finalStr+=String.fromCharCode(14,18,15);break;case"╞\xc6":finalStr+=String.fromCharCode(14,19,15);break;case"┼\xe1":finalStr+=String.fromCharCode(14,20,15);break;case"Γ\xc7░":finalStr+=String.fromCharCode(14,21,15);break;case"╦\xe5":finalStr+=String.fromCharCode(14,22,15);break;case"∩┐╜":finalStr+=String.fromCharCode(14,23,15);break;case"Γ\xc7╣":finalStr+=String.fromCharCode(14,24,15);break;case"┼\xc6":finalStr+=String.fromCharCode(14,25,15);break;case"Γ\xc7\xf3":finalStr+=String.fromCharCode(14,26,15);break;case"\xe5":finalStr+=String.fromCharCode(14,27,15);break;case"Γ\xc7\xa5":finalStr+=String.fromCharCode(14,28,15);break;case"Γ\xc7\xa3":finalStr+=String.fromCharCode(14,29,15);break;case"Γ\xc7\xf6":finalStr+=String.fromCharCode(14,30,15);break;case"Γ\xc7\xf4":finalStr+=String.fromCharCode(14,31,15);break;case"\xe1":finalStr+=String.fromCharCode(14,35,15);break;default:finalStr+=e.charAt(t)}return finalStr}function readText(){readTextStr="",saveX=windows.windows[windows.activeWindow].currentX,saveY=windows.windows[windows.activeWindow].currentY,(224&flags.getFlag(49))==224&&(readTextStr=TimeoutPreservedOrder,TimeoutPreservedOrder=""),flags.setFlag(49,63&flags.getFlag(49)),writeText(readTextStr+"_",!1),timeoutHappened=!1,timeoutSeconds=flags.getFlag(48),ticks=getTicks(),playerPressedKey=!1}function readTextB(e){var t=(windows.windows[windows.activeWindow].col+windows.windows[windows.activeWindow].width)*6;e>=32&&e<=255?(readTextStr.length+2)*6+saveX<t&&(readTextStr+=String.fromCharCode(e)):8==e&&""!=readTextStr&&(clearWindow(saveX+6*readTextStr.length,saveY,6,8,windows.windows[windows.activeWindow].PAPER),readTextStr=readTextStr.slice(0,-1)),windows.windows[windows.activeWindow].currentX=saveX,windows.windows[windows.activeWindow].currentY=saveY,writeText(PatchStr(readTextStr)+"_",!1),13==e&&""!=readTextStr&&(clearWindow(saveX+6*readTextStr.length,saveY,6,8,windows.windows[windows.activeWindow].PAPER),carriageReturn(),inputBuffer=readTextStr,getCommandB())}function carriageReturn(){windows.windows[windows.activeWindow].currentX=6*windows.windows[windows.activeWindow].col,windows.windows[windows.activeWindow].currentY=windows.windows[windows.activeWindow].currentY+8,windows.windows[windows.activeWindow].lastPauseLine=windows.windows[windows.activeWindow].lastPauseLine+1,windows.windows[windows.activeWindow].currentY>=(windows.windows[windows.activeWindow].line+windows.windows[windows.activeWindow].height)*8&&ScrollCurrentWindow(),windows.lastPrintedIsCR=!0}function clearCurrentWindow(){clearWindow(6*windows.windows[windows.activeWindow].col,8*windows.windows[windows.activeWindow].line,6*windows.windows[windows.activeWindow].width,8*windows.windows[windows.activeWindow].height,windows.windows[windows.activeWindow].PAPER),windows.windows[windows.activeWindow].currentY=8*windows.windows[windows.activeWindow].line,windows.windows[windows.activeWindow].currentX=6*windows.windows[windows.activeWindow].col,windows.windows[windows.activeWindow].lastPauseLine=0}function reconfigureWindow(){windows.windows[windows.activeWindow].col+windows.windows[windows.activeWindow].width>50&&(windows.windows[windows.activeWindow].width=50-windows.windows[windows.activeWindow].col),windows.windows[windows.activeWindow].line+windows.windows[windows.activeWindow].height>25&&(windows.windows[windows.activeWindow].height=25-windows.windows[windows.activeWindow].line)}function ScrollCurrentWindow(){var e=windows.windows[windows.activeWindow],t=paper.getImageData(6*e.col,(e.line+1)*8,6*e.width,(e.height-1)*8);clearWindow(6*e.col,(e.line+e.height-1)*8,6*e.width,8,e.PAPER),paper.putImageData(t,6*e.col,8*e.line),e.currentY-=8,e.currentX=6*e.col}function newtext(){inputBuffer=""}function Sound(e,t){void 0===audioContext&&(audioContext=new(window.AudioContext||window.webkitAudioContext));var a=audioContext.createOscillator();a.type="square",a.frequency.value=e,a.connect(audioContext.destination),a.start(),delay(t),a.stop()}function getTicks(){return Date.now()}function PreserveStream(){windows.backupStream=windows.activeWindow,0!=flags.getFlag(41)&&8>flags.getFlag(41)&&(windows.activeWindow=flags.getFlag(41))}function RestoreStream(){(8&flags.getFlag(49))==8&&clearCurrentWindow(),windows.activeWindow=windows.backupStream,(16&flags.getFlag(49))==16&&(Sysmess(33),writeText(PatchedStr+chr(13)))}function Sysmess(e){var t=Parameter1;Parameter1=e,_SYSMESS(),Parameter1=t}function resizeScreen(){var e=window.innerHeight,t=window.innerWidth,a=e-200,n=Math.round(4*a/3);n>t&&(n=t-100,a=Math.round(3*t/4)),$(".wrapper").css("width",n+"px"),$(".wrapper").css("height",a+"px");var o=4.5*n/t;$("body").css("font-size",o+"vw")}function listObjects(e,t){var a=objects.getObjectCountAt(e),n=(64&flags.getFlag(53))!=0,o=0;if(a>0){flags.setFlag(53,128|flags.getFlag(53)),t||(Sysmess(1),n||_NEWLINE());for(var s=0;s<DDB.header.numObj;s++)objects.getObjectLocation(s)==e&&(writeText(getMessageOTX(s,!1,!1,n)),o++,n?o==a?Sysmess(48):o==a-1?Sysmess(47):Sysmess(46):_NEWLINE())}else flags.setFlag(53,127&flags.getFlag(53)),t&&Sysmess(53)}function _XMES(){var e=Parameter1;DDB.condactPTR++,Xmes(e+=256*DDB.getByte(condactPTR)),done=!0}function _XPART(){XPart(Parameter1)}function _AT(){condactResult=flags.getFlag(38)==Parameter1}function _NOTAT(){condactResult=flags.getFlag(38)!=Parameter1}function _ATGT(){condactResult=flags.getFlag(38)>Parameter1}function _ATLT(){condactResult=flags.getFlag(38)<Parameter1}function _PRESENT(){condactResult=(objectLocation=objects.getObjectLocation(Parameter1))==LOC_CARRIED||253==objectLocation||objectLocation==flags.getFlag(38)}function _ABSENT(){condactResult=(objectLocation=objects.getObjectLocation(Parameter1))!=LOC_CARRIED&&253!=objectLocation&&objectLocation!=flags.getFlag(38)}function _WORN(){condactResult=253==objects.getObjectLocation(Parameter1)}function _NOTWORN(){condactResult=253!=objects.getObjectLocation(Parameter1)}function _CARRIED(){condactResult=objects.getObjectLocation(Parameter1)==LOC_CARRIED}function _NOTCARR(){condactResult=objects.getObjectLocation(Parameter1)!=LOC_CARRIED}function _CHANCE(){condactResult=!(Parameter1>100)&&Math.floor(101*Math.random())<=Parameter1}function _ZERO(){condactResult=0==flags.getFlag(Parameter1)}function _NOTZERO(){condactResult=0!=flags.getFlag(Parameter1)}function _EQ(){condactResult=flags.getFlag(Parameter1)==Parameter2}function _GT(){condactResult=flags.getFlag(Parameter1)>Parameter2}function _LT(){condactResult=flags.getFlag(Parameter1)<Parameter2}function _ADJECT1(){condactResult=flags.getFlag(35)==Parameter1}function _ADVERB(){condactResult=flags.getFlag(36)==Parameter1}function _SFX(){done=!0}function _DESC(){writeText(getMessage(DDB.header.locationPos,Parameter1)),done=!0}function _QUIT(){PreserveTimeout=flags.getFlag(48),flags.setFlag(48,0),PreserveStream(),Sysmess(12),inputBuffer="",inQUIT=!0,getPlayerOrders()}function _QUITB(){var e=getMessage(DDB.header.sysmessPos,30).charAt(0).toUpperCase();condactResult=!1,""!=inputBuffer&&inputBuffer.substring(0,1).toUpperCase()==e&&(condactResult=!0),flags.setFlag(48,PreserveTimeout),windows.windows[windows.activeWindow].lastPauseLine=0,inputBuffer="",done=!0,RestoreStream(),condactResult?(DDB.condactPTR++,run(!0)):(DDB.entryPTR+=4,run(!1))}function _SAVE(){PreserveTimeout=flags.getFlag(48),flags.setFlag(48,0),PreserveStream(),Sysmess(60),inputBuffer="",inSAVE=!0,getPlayerOrders()}function _SAVEB(){doSave(inputBuffer),flags.setFlag(48,PreserveTimeout),windows.windows[windows.activeWindow].lastPauseLine=0,inputBuffer="",done=!0,RestoreStream(),DDB.condactPTR++,run(!0)}function _LOAD(){_SAVE(),inSAVE=!1,inLOAD=!0}function _LOADB(){condactResult=!0,doLoad(inputBuffer)||(flags.setFlag(48,PreserveTimeout),windows.windows[windows.activeWindow].lastPauseLine=0,condactResult=!1),inputBuffer="",done=!0,RestoreStream(),condactResult?(DDB.condactPTR++,run(!0)):(DDB.entryPTR+=4,run(!1))}function _END(){PreserveTimeout=flags.getFlag(48),flags.setFlag(48,0),Sysmess(13),inputBuffer="",inEND=!0,getPlayerOrders()}function _ENDB(){var e=getMessage(DDB.header.sysmessPos,30).charAt(0).toUpperCase();condactResult=!1,""!=inputBuffer&&inputBuffer.substring(0,1).toUpperCase()==e&&(condactResult=!0),condactResult?window.location.reload():$(".goodbye").show()}function _DONE(){done=!0,DDB.ConsumeProcess,condactResult=!1}function _OK(){Sysmess(15),_DONE()}function _ANYKEY(){inANYKEY=!0}function _DPRINT(){var e=flags.getFlag(Parameter1)+256*flags.getFlag(Parameter1+1);writeText(e+""),done=!0}function _DISPLAY(){windows.windows[windows.activeWindow].col,windows.windows[windows.activeWindow].line;var e=6*windows.windows[windows.activeWindow].width,t=8*windows.windows[windows.activeWindow].height,a=document.getElementById("imageBuffer"),n=a.naturalWidth,o=a.naturaHeight;e>o&&(e=o),t>n&&(t=n),paper.drawImage(a,0,0,t,e),done=!0}function _CLS(){clearCurrentWindow(),done=!0}function _DROPALL(){for(var e=flags.getFlag(38),t=LOC_CARRIED;t<=253;t++){nextObject=-1;do 255!=(nextObject=objects.getNextObjectAt(nextObject,t))&&(Parameter1=nextObject,Parameter2=e,_PLACE());while(255!=nextObject)}done=!0}function _AUTOG(){var e=flags.getFlag(34),t=flags.getFlag(35);if(255!=(Parameter1=objects.getObjectByVocabularyAtLocation(e,t,flags.getFlag(38)))||255!=(Parameter1=objects.getObjectByVocabularyAtLocation(e,t,253))||255!=(Parameter1=objects.getObjectByVocabularyAtLocation(e,t,LOC_CARRIED))){_GET();return}255!=(Parameter1=objects.getObjectByVocabularyAtLocation(e,t,255))?Sysmess(26):Sysmess(8),newtext(),_DONE()}function _AUTOD(){var e=flags.getFlag(34),t=flags.getFlag(35);if(debug("AUTOD: "+(Parameter1=objects.getObjectByVocabularyAtLocation(e,t,LOC_CARRIED))),255!=Parameter1||255!=(Parameter1=objects.getObjectByVocabularyAtLocation(e,t,253))||255!=(Parameter1=objects.getObjectByVocabularyAtLocation(e,t,flags.getFlag(38)))){_DROP();return}255!=(Parameter1=objects.getObjectByVocabularyAtLocation(e,t,255))?Sysmess(28):Sysmess(8),newtext(),_DONE()}function _AUTOW(){var e=flags.getFlag(34),t=flags.getFlag(35);if(255!=(Parameter1=objects.getObjectByVocabularyAtLocation(e,t,LOC_CARRIED))||255!=(Parameter1=objects.getObjectByVocabularyAtLocation(e,t,253))||255!=(Parameter1=objects.getObjectByVocabularyAtLocation(e,t,flags.getFlag(38)))){_WEAR();return}255!=(Parameter1=objects.getObjectByVocabularyAtLocation(e,t,255))?Sysmess(28):Sysmess(8),newtext(),_DONE()}function _AUTOR(){var e=flags.getFlag(34),t=flags.getFlag(35);if(255!=(Parameter1=objects.getObjectByVocabularyAtLocation(e,t,253))||255!=(Parameter1=objects.getObjectByVocabularyAtLocation(e,t,LOC_CARRIED))||255!=(Parameter1=objects.getObjectByVocabularyAtLocation(e,t,flags.getFlag(38)))){_REMOVE();return}255!=(Parameter1=objects.getObjectByVocabularyAtLocation(e,t,255))?Sysmess(23):Sysmess(8),newtext(),_DONE()}function _PAUSE(){delay((Parameter1=0)/50),done=!0}function _SYNONYM(){255!=Parameter1&&flags.setFlag(33,Parameter1),255!=Parameter2&&flags.setFlag(34,Parameter2),done=!0}function _GOTO(){flags.setFlag(38,Parameter1),done=!0}function _MESSAGE(){_MES(),_NEWLINE()}function _REMOVE(){objects.setReferencedObject(Parameter1);var e=objects.getObjectLocation(Parameter1);if(e==LOC_CARRIED||e==flags.getFlag(38)){Sysmess(50),newtext(),_DONE();return}if(253!=e&&e!=flags.getFlag(38)){Sysmess(23),newtext(),_DONE();return}if(!objects.isObjectWearable(Parameter1)){Sysmess(41),newtext(),_DONE();return}if(flags.getFlag(38)>=flags.getFlag(37)){Sysmess(42),newtext(),_DONE();return}objects.setObjectLocation(Parameter1,LOC_CARRIED),flags.setFlag(1,flags.getFlag(1)+1),Sysmess(38),done=!0}function _GET(){if(objects.setReferencedObject(Parameter1),253==(ObjectLocation=objects.getObjectLocation(Parameter1))||ObjectLocation==LOC_CARRIED){Sysmess(25),newtext(),_DONE();return}if(ObjectLocation!=flags.getFlag(38)){Sysmess(26),newtext(),_DONE();return}var e=objects.getWeightOfObjectsAt(LOC_CARRIED);if(objects.getWeightOfObjectsAt(253)+e+objects.getObjectFullWeight(Parameter1)>flags.getFlag(52)){Sysmess(43),newtext(),_DONE();return}if(flags.getFlag(1)>=flags.getFlag(37)){Sysmess(27),doallPTR=0,newtext(),_DONE();return}objects.setObjectLocation(Parameter1,LOC_CARRIED),flags.setFlag(1,flags.getFlag(1)+1),Sysmess(36),done=!0}function _DROP(){objects.setReferencedObject(Parameter1);var e=objects.getObjectLocation(Parameter1);if(253==e){Sysmess(24),newtext(),_DONE();return}if(e==flags.getFlag(38)){Sysmess(49),newtext(),_DONE();return}if(e!=flags.getFlag(38)&&e!=LOC_CARRIED){Sysmess(28),newtext(),_DONE();return}objects.setObjectLocation(Parameter1,flags.getFlag(38)),flags.setFlag(1,flags.getFlag(1)-1),Sysmess(39),done=!0}function _WEAR(){objects.setReferencedObject(Parameter1);var e=objects.getObjectLocation(Parameter1);if(e==flags.getFlag(38)){Sysmess(49),newtext(),_DONE();return}if(253==e){Sysmess(29),newtext(),_DONE();return}if(e!=LOC_CARRIED){Sysmess(28),newtext(),_DONE();return}objects.isObjectWearable(Parameter1)||(Sysmess(40),newtext(),_DONE(),exit),objects.setObjectLocation(Parameter1,253),flags.setFlag(1,flags.getFlag(1)-1),Sysmess(37),done=!0}function _DESTROY(){Parameter2=252,_PLACE()}function _CREATE(){Parameter2=flags.getFlag(38),_PLACE()}function _SWAP(){objects.getObjectLocation(Parameter1),objects.setObjectLocation(Parameter1,objects.getObjectLocation(Parameter2)),objects.setObjectLocation(Parameter2,aux),objects.setReferencedObject(Parameter2),done=!0}function _PLACE(){objects.getObjectLocation(Parameter1)==LOC_CARRIED&&flags.setFlag(1,flags.getFlag(1)-1),objects.setObjectLocation(Parameter1,Parameter2),objects.getObjectLocation(Parameter1)==LOC_CARRIED&&flags.setFlag(1,flags.getFlag(1)+1),done=!0}function _SET(){flags.setFlag(Parameter1,255),done=!0}function _CLEAR(){flags.setFlag(Parameter1,0),done=!0}function _PLUS(){flags.getFlag(Parameter1)+Parameter2>255?_SET():flags.setFlag(Parameter1,flags.getFlag(Parameter1)+Parameter2),done=!0}function _MINUS(){flags.getFlag(Parameter1)-Parameter2<0?_CLEAR():flags.setFlag(Parameter1,flags.getFlag(Parameter1)-Parameter2),done=!0}function _LET(){flags.setFlag(Parameter1,Parameter2),done=!0}function _NEWLINE(){carriageReturn(),done=!0}function _PRINT(){valstr=(value=flags.getFlag(Parameter1))+"",writeText(valstr),done=!0}function _SYSMESS(){writeText(getMessage(DDB.header.sysmessPos,Parameter1)),done=!0}function _ISAT(){condactResult=objects.getObjectLocation(Parameter1)==Parameter2}function _SETCO(){objects.setReferencedObject(Parameter1),done=!0}function _SPACE(){writeText(" "),done=!0}function _HASAT(){condactResult=flags.getFlagBit(59-Math.floor(Parameter1,8),Parameter1%8)}function _HASNAT(){condactResult=!flags.getFlagBit(59-Math.floor(Parameter1,8),Parameter1%8)}function _LISTOBJ(){listObjects(flags.getFlag(38),!1),done=!0}function _EXTERN(){switch(Parameter2){case 3:_XMES();return;case 4:_XPART();return}condactResult=Extern(Parameter1,Parameter2)}function _RAMSAVE(){objects.RAMSAVEObjects(),flags.RAMSAVEFlags(),done=!0}function _RAMLOAD(){objects.RAMLOADObjects(),flags.RAMLOADFlags(Parameter1),done=!0}function _BEEP(){Parameter2>=24&&Parameter2<=238&&Parameter2%2==0&&Sound(FREQ_TABLE[Parameter2-24>>1],Parameter1/100),done=!0}function _PAPER(){windows.windows[windows.activeWindow].PAPER=Parameter1%16,done=!0}function _INK(){windows.windows[windows.activeWindow].INK=Parameter1%16,done=!0}function _BORDER(){windows.windows[windows.activeWindow].BORDER=Parameter1%16,document.getElementById("screen").style.backgroundColor=colours[Parameter1],done=!0}function _PREP(){condactResult=flags.getFlag(43)==Parameter1}function _NOUN2(){condactResult=flags.getFlag(44)==Parameter1}function _ADJECT2(){condactResult=flags.getFlag(45)==Parameter1}function _ADD(){flags.getFlag(Parameter1)-flags.getFlag(Parameter2)>255?flags.setFlag(Parameter2,255):flags.setFlag(Parameter2,flags.getFlag(Parameter1)+flags.getFlag(Parameter2)),done=!0}function _SUB(){flags.getFlag(Parameter2)-flags.getFlag(Parameter1)<0?flags.setFlag(Parameter2,0):flags.setFlag(Parameter2,flags.getFlag(Parameter2)-flags.getFlag(Parameter1)),done=!0}function _PARSE(){var e=parse(Parameter1);inPARSE||(condactResult=!e,done=!1)}function _LISTAT(){listObjects(Parameter1,!0),done=!0}function _PROCESS(){Parameter1>=DDB.header.numPro&&Error(3,"Process "+Parameter1+"does not exist"),stack.stackPush(),DDB.condactPTR=0,DDB.processPTR=DDB.header.processPos+2*Parameter1,DDB.entryPTR=DDB.getWord(DDB.processPTR)-4,condactResult=!1,done=!1}function _SAME(){condactResult=flags.getFlag(Parameter1)==flags.getFlag(Parameter2)}function _MES(){writeText(getMessage(DDB.header.messagePos,Parameter1)),done=!0}function _WINDOW(){Parameter1<8&&(windows.activeWindow=Parameter1,flags.setFlag(63,Parameter1)),done=!0}function _NOTEQ(){condactResult=flags.getFlag(Parameter1)!=Parameter2}function _NOTSAME(){condactResult=flags.getFlag(Parameter1)!=flags.getFlag(Parameter2)}function _MODE(){windows.windows[windows.activeWindow].OperationMode=Parameter1,done=!0}function _WINAT(){windows.windows[windows.activeWindow].line=Parameter1,windows.windows[windows.activeWindow].currentY=8*Parameter1,windows.windows[windows.activeWindow].col=Parameter2,windows.windows[windows.activeWindow].currentX=6*Parameter2,reconfigureWindow(),done=!0}function _TIME(){flags.setFlag(48,Parameter1),flags.setFlag(49,Parameter2),done=!0}function _PICTURE(){for(var e=Parameter1+"";e.length<3;)e="0"+e;condactResult=!1,images.includes(e)&&(e+=".png",$("#imageBuffer").attr("src",e),condactResult=!0),done=!0}function _DOALL(){0!=DDB.doallPTR&&(writeText("Runtime error 4 - Invalid nested DOALL"),Parameter1=0),255!=(objno=objects.getNextObjectAt(-1,Parameter1))?(DDB.doallPTR=DDB.condactPTR+1,DDB.doallEntryPTR=DDB.entryPTR,DDB.doallLocation=Parameter1,flags.setFlag(50,objno),objects.setReferencedObject(objno),done=!0):(debug("Mal doall"),Sysmess(8),newtext(),_DONE())}function _MOUSE(){done=!0}function _GFX(){done=!0}function _ISNOTAT(){condactResult=objects.getObjectLocation(Parameter1)!=Parameter2}function _WEIGH(){flags.setFlag(Parameter2,getObjectFullWeight(Parameter1)),done=!0}function _PUTIN(){if(objects.setReferencedObject(Parameter1),253==(ObjectLocation=objects.getObjectLocation(Parameter1))){Sysmess(24),newtext(),_DONE();return}if(ObjectLocation==flags.getFlag(38)){Sysmess(49),newtext(),_DONE();return}if(ObjectLocation!=flags.getFlag(38)&&ObjectLocation!=LOC_CARRIED){Sysmess(28),newtext(),_DONE();return}objects.setObjectLocation(Parameter1,Parameter2),flags.setFlag(1,flags.getFlag(1)-1),Sysmess(44),_SPACE(),writeText(getMessageOTX(Parameter2,!0,!1,!0)),Sysmess(51),done=!0}function _NEWTEXT(){newtext(),done=!0}function _TAKEOUT(){if(objects.setReferencedObject(Parameter1),253==(ObjectLocation=objects.getObjectLocation(Parameter1))||ObjectLocation==LOC_CARRIED){Sysmess(45),newtext(),_DONE();return}if(ObjectLocation==flags.getFlag(38)){Sysmess(49),writeText(getMessageOTX(Parameter2,!0,!1,!0),!1),Sysmess(51),newtext(),_DONE();return}if(ObjectLocation!=flags.getFlag(38)&&ObjectLocation!=Parameter2){Sysmess(52),_SPACE(),writeText(getMessageOTX(Parameter2,!0,!1,!0),!1),Sysmess(51),newtext(),_DONE();return}if(ObjectLocation!=LOC_CARRIED&&253!=ObjectLocation){var e;if(objects.getObjectFullWeight(LOC_CARRIED)+objects.getObjectFullWeight(253)+objects.getObjectFullWeight(Parameter1)>flags.getFlag(52)){Sysmess(43),newtext(),_DONE();return}}if(flags.getFlag(1)>=flags.getFlag(37)){Sysmess(27),newtext(),doallPTR=0,_DONE();return}objects.setObjectLocation(Parameter1,LOC_CARRIED),flags.setFlag(1,flags.getFlag(1)+1),Sysmess(36),done=!0}function _ABILITY(){flags.setFlag(37,Parameter1),flags.setFlag(52,Parameter2),done=!0}function _WEIGHT(){for(var e=0,t=0;t<DDB.header.numObj;t++)((l=objects.getObjectLocation(t))==LOC_CARRIED||253==l)&&(e+(w2=objects.getObjectFullWeight(t))>255?e=255:e+=w2);flags.setFlag(Parameter1,e),done=!0}function _RANDOM(){flags.setFlag(Parameter1,Math.floor(101*Math.random())),done=!0}function _INPUT(){Parameter1<8&&(flags.setFlag(41,Parameter1),Parameter2<<=3,Parameter2&=56,flag49=199&flags.getFlag(49),flags.setFlag(49,flag49|Parameter2)),done=!0}function _SAVEAT(){SaveAt(),done=!0}function _BACKAT(){BackAt(),done=!0}function _PRINTAT(){Printat(Parameter1,Parameter2),done=!0}function _WHATO(){var e=flags.getFlag(34),t=flags.getFlag(33),a=objects.getObjectByVocabularyAtLocation(e,t,LOC_CARRIED);255!=a?objects.setReferencedObject(a):255!=(a=objects.getObjectByVocabularyAtLocation(e,t,253))?objects.setReferencedObject(a):255!=(a=objects.getObjectByVocabularyAtLocation(e,t,flags.getFlag(38)))?objects.setReferencedObject(a):255!=(a=objects.getObjectByVocabularyAtLocation(e,t,255))?objects.setReferencedObject(a):objects.setReferencedObject(255),done=!0}function _CALL(){done=!0}function _PUTO(){Parameter2=Parameter1,Parameter1=flags.getFlag(51),_PLACE(),done=!0}function _NOTDONE(){done=!1,DDB.ConsumeProcess(),condactResult=!1}function _AUTOP(){if(Parameter2=Parameter1,Noun=flags.getFlag(34),Adject=flags.getFlag(35),255!=(Parameter1=objects.getObjectByVocabularyAtLocation(Noun,Adject,LOC_CARRIED))||255!=(Parameter1=objects.getObjectByVocabularyAtLocation(Noun,Adject,253))||255!=(Parameter1=objects.getObjectByVocabularyAtLocation(Noun,Adject,flags.getFlag(38)))){_PUTIN();return}255!=(Parameter1=objects.getObjectByVocabularyAtLocation(Noun,Adject,255))?Sysmess(28):Sysmess(8),newtext(),_DONE()}function _AUTOT(){Parameter2=Parameter1;var e=flags.getFlag(34),t=flags.getFlag(35);if(255!=(Parameter1=objects.getObjectByVocabularyAtLocation(e,t,Parameter2))||255!=(Parameter1=objects.getObjectByVocabularyAtLocation(e,t,LOC_CARRIED))||255!=(Parameter1=objects.getObjectByVocabularyAtLocation(e,t,253))||255!=(Parameter1=objects.getObjectByVocabularyAtLocation(e,t,flags.getFlag(38)))){_TAKEOUT();return}255!=(Parameter1=objects.getObjectByVocabularyAtLocation(e,t,255))?(Sysmess(52),writeText(getMessageOTX(Parameter2,!0,!1,!0)),Sysmess(51)):Sysmess(8),newtext(),_DONE()}function _MOVE(){var e=DDB.getWord(DDB.header.connectionPos+2*flags.getFlag(Parameter1));do{var t=DDB.getByte(e);if(255!=t&&t==flags.getFlag(33)){flags.setFlag(Parameter1,DDB.getByte(e+1));return}e+=2}while(255!=t);condactResult=!1}function _WINSIZE(){windows.windows[windows.activeWindow].height=Parameter1,windows.windows[windows.activeWindow].width=Parameter2,reconfigureWindow(),done=!0}function _REDO(){DDB.entryPTR=DDB.getWord(DDB.processPTR)-4,condactResult=!1}function _CENTRE(){windows.windows[windows.activeWindow].col=50-windows.windows[windows.activeWindow].width>>1}function _EXIT(){resetWindows(),Parameter1=0,resetWindows(),flags.resetFlags(),resetObjects(),_RESTART()}function _INKEY(){keyBoardStatus.length?(flags.setFlag(60,keyBoardStatus[keyBoardStatus.length-1]),flags.setFlag(61,keyBoardStatusShiftKeys),condactResult=!0):(flags.setFlag(60,0),flags.setFlag(61,0),condactResult=!1)}function _BIGGER(){condactResult=flags.getFlag(Parameter1)>flags.getFlag(Parameter2)}function _SMALLER(){condactResult=flags.getFlag(Parameter1)<flags.getFlag(Parameter2)}function _ISDONE(){condactResult=done}function _ISNDONE(){condactResult=!done}function _SKIP(){var e;e=Parameter1>=128?Parameter1-256:Parameter1,DDB.entryPTR=DDB.entryPTR+4*e,condactResult=!1}function _RESTART(){DDB.resetProcesses(),stack.resetStack(),DDB.entryPTR=DDB.getWord(DDB.processPTR)-4,condactResult=!1}function _TAB(){Tab(Parameter1),done=!0}function _COPYOF(){flags.setFlag(Parameter2,objects.getObjectLocation(Parameter1)),done=!0}function _COPYOO(){aux=Parameter2,Parameter2=objects.getObjectLocation(Parameter1),Parameter1=aux,_PLACE()}function _COPYFO(){aux=Parameter2,Parameter2=flags.getFlag(Parameter1),Parameter1=aux,_PLACE()}function _dumb(){}function _COPYFF(){flags.setFlag(Parameter2,flags.getFlag(Parameter1)),done=!0}function _COPYBF(){flags.setFlag(Parameter1,flags.getFlag(Parameter2)),done=!0}function _RESET(){objects.resetObjects(),done=!0}String.prototype.hexEncode=function(){var e,t,a="";for(t=0;t<this.length;t++)a+=("000"+(e=this.charCodeAt(t).toString(16))).slice(-4);return a},$(document).ready(function(){console.log("jDAAD 1.0 (C) Uto"),$(window).resize(function(){resizeScreen()}),$(document).keydown(function(e){keydownHandler(e)}),$(document).keyup(function(e){keyupHandler(e)}),paper=document.getElementById("paper").getContext("2d",{willReadFrequently:!0}),resizeScreen(),flags.resetFlags(),objects.resetObjects(),windows.resetWindows(),initializeParser(),stack.resetStack(),DDB.resetProcesses(),$("#paper").focus(),run(!1)});