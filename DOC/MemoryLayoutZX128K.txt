This document describes the memory layout for the ZX128K.BAT target, so programmers
can understand how the DAAD interpreter acommodates the game data in the memory,
and can think of solutions in case they run out of space.

The Spectrum 128K has 8 banks of RAM, each 16K in size, numbered from 0 to  7. From
those, the DAAD interpreter uses some banks for its own purposes, while the rest, 
and in some cases even the not used part of those banks, are used for the game
data and graphics.

The DAAD interpreter has to handle three different types of data:
1. The DDB, the data file that contains messages, locations, connections, vocabulary
   and processes' code.
2. The XMESSAGES, which are messages that can be used in the game, but are not part
    of the DDB.
3. The images, which are graphics that can be used in the game.

The order we list the banks may look a bit strange, but it is the way
the Sinclair engineers designed the memory layout.

Bank 5: ZX Spectrum stores the screen area in this bank (7.75K). The rest
is used by the DAAD interpreter. It cannot be used for anything else.

Bank 2: This bank is used by the DDB, and even in the case you make a very
small game, and bank 2 is not completely filled, the DAAD interpreter will
reserve the whole bank for the DDB, so it is not available images or Xmessages.

Bank 0: if the game is big enough, the DDB will fill bank 2 and extend
to bank 0. This bank cannot be filled completely, though, as the charset is
stored, so the DDB has a bit less than 14K available in this bank. In case
the DDB does not fill the whole available space, the remaining bytes
are used for images, up to the position of the charset.

Bank 1: At the beginning of this bank, the DAAD keeps 512 bytes to store
the RAMSAVE data, followed by 6912 bytes the interpreter uses as buffer to 
print pictures. The remaining bytes are free to be used by images.

Banks 3, 4, 6 and 7: These banks are used for XMESSAGES and images.

What does DAAD Ready do?
========================

First the DDB is generated, and saved in Bank 2 and if it's bigger than 16K, extends
to bank 0. The charset is stored in the upper part of bank 0. 

Then the XMESSAGES are added to banks 3, 4, 6 and 7 as needed, depending on how many
of them there are, and the remaining space in those banks is filled will images.

Finally, if there is need for more room for images, the  remaining space in bank 1 is used,
and then the remaining space in bank 0.

What should I do if I run out of space?
=======================================

First you need to determine where are you having the problem:

If bank 0 is full, then your DDB is too big,  and you will probably get a warning from the 
compiler about it. You can reduce the size of the DDB by changing some MES or MESSAGE 
commands to XMES and XMESSAGE. That will make those texts move to other banks and free space
in bank 0.

If you run out of space for the graphics, then you can do the opposite and change XMES/XMESSAGE
to MES/MESSAGE, but it is not likely that would help a lot unless you have many Xmessages. The
best thing you can do is checking the size of the image you can't fit in, and the free space 
in the banks. Look for the biggest gap, and see if you can reduce the complexity of the image so
once compressed, it fits in the available space. Image compression is better if the image has
empty space, so you can reduce the number of random pixels, and also is better if there are
patterns of pixels that repeat (i.e. a wall with bricks, or a floor with tiles, a gate with
bars).

Remember you have to delete de .zx0 file in the IMAGES folder in order to recompress the image, 
otherwise it will not change.

If the closest gap is in bank 0, then maybe reducing the the length of some texts, or changing them
to Xmessages may do the trick (i.e. if you have a 3K image and the gap in bank 0 is 2.9K, then you 
changin some message to xmessage will move those texts to banks 3, 4, 6 or 7, and make enough space
in bank, but that would only help if banks 3, 4, 6 or 7 have space to move the Xmessages to).

Please notice bank 2 can only be used for the DDB, so no matter if you do a very short adventure with
a very small DDB but that doesn't fill bank 2, that gap won't be used for images. Anyway, it's not
likely to have a such a small DDB, and so many images at the same time.